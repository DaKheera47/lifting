<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lifting Progression Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
  <!-- tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #09090b; }
    .card { transition: background-color .2s ease, box-shadow .2s ease; }
    .card:hover { box-shadow: 0 4px 18px -2px rgba(0,0,0,0.55); }
    .chart { width: 100%; }
  </style>
</head>
<body class="text-zinc-200 antialiased">
  <main class="mx-auto max-w-[1700px] px-6 py-6 space-y-8">
    <header class="flex flex-col gap-2">
  <h1 class="text-3xl font-bold tracking-tight">Progression • Overload • Balance</h1>
      <p class="text-sm text-zinc-500">Focused dashboard – no fluff. Data last updated: <span id="lastIngested" class="text-zinc-300">...</span></p>
    </header>

    <!-- Filters -->
    <div id="filterBar" class="flex flex-wrap gap-3 items-center bg-zinc-900/60 backdrop-blur rounded-2xl p-4 ring-1 ring-zinc-800">
      <div class="relative" id="exerciseMulti"></div>
      <div class="flex gap-1" id="metricToggle"></div>
    </div>

    <!-- PR Sparklines -->
    <section>
      <h2 class="text-xl font-semibold mb-3">Personal Record Sparklines</h2>
      <div id="sparklineContainer" class="grid gap-4 md:grid-cols-3 lg:grid-cols-5 auto-rows-fr"></div>
    </section>

  <section class="grid gap-6 grid-cols-1 md:grid-cols-12">
      <!-- Progressive Overload -->
      <div class="card col-span-12 bg-zinc-900 rounded-2xl ring-1 ring-zinc-800 shadow-sm p-5 flex flex-col">
        <div class="flex items-center justify-between mb-2">
          <h2 class="text-xl font-semibold">Progressive Overload</h2>
          <button id="resetOverloadZoom" class="text-xs px-2 py-1 rounded bg-zinc-800 hover:bg-zinc-700">Reset Zoom</button>
        </div>
  <div id="progressiveOverloadChart" class="chart" style="height:300px" data-fixed-height="true"></div>
        <div class="mt-3 flex flex-col gap-2">
          <div id="poLegend" class="flex flex-wrap gap-2 text-xs"></div>
          <div id="overloadSlopes" class="flex flex-wrap gap-2 text-xs"></div>
        </div>
      </div>

      <!-- Volume Trend -->
      <div class="card col-span-12 md:col-span-8 bg-zinc-900 rounded-2xl ring-1 ring-zinc-800 shadow-sm p-5 flex flex-col">
        <h2 class="text-xl font-semibold mb-2">Session Volume Trend</h2>
  <div id="volumeTrendChart" class="chart" style="height:240px" data-fixed-height="true"></div>
      </div>

      <!-- Volume Per Exercise (Daily) -->
      <div class="card col-span-12 md:col-span-4 bg-zinc-900 rounded-2xl ring-1 ring-zinc-800 shadow-sm p-5 flex flex-col">
        <div class="flex items-center justify-between mb-2">
          <h2 class="text-xl font-semibold">Volume / Exercise</h2>
          <button id="volumeModeToggle" class="text-xs px-2 py-1 rounded bg-zinc-800 hover:bg-zinc-700" data-mode="stacked">Stacked</button>
        </div>
        <div id="exerciseVolumeChart" class="chart" style="height:240px" data-fixed-height="true"></div>
      </div>

      <!-- Rep Distribution -->
      <div class="card col-span-12 md:col-span-4 bg-zinc-900 rounded-2xl ring-1 ring-zinc-800 shadow-sm p-5 flex flex-col">
        <div class="flex items-center justify-between mb-2">
          <h2 class="text-xl font-semibold">Rep Range Distribution</h2>
          <button id="repModeToggle" class="text-xs px-2 py-1 rounded bg-zinc-800 hover:bg-zinc-700" data-mode="weekly">Weekly</button>
        </div>
  <div id="repDistributionChart" class="chart" style="height:240px" data-fixed-height="true"></div>
      </div>

      <!-- Weekly PPL -->
      <div class="card col-span-12 md:col-span-7 bg-zinc-900 rounded-2xl ring-1 ring-zinc-800 shadow-sm p-5 flex flex-col">
        <div class="flex items-center justify-between mb-2">
          <h2 class="text-xl font-semibold">Push / Pull / Legs Weekly</h2>
          <button id="pplModeToggle" class="text-xs px-2 py-1 rounded bg-zinc-800 hover:bg-zinc-700" data-mode="absolute">Absolute</button>
        </div>
  <div id="weeklyPPLChart" class="chart" style="height:240px" data-fixed-height="true"></div>
      </div>

      <!-- Muscle Balance 28d -->
      <div class="card col-span-12 md:col-span-5 bg-zinc-900 rounded-2xl ring-1 ring-zinc-800 shadow-sm p-5 flex flex-col">
        <h2 class="text-xl font-semibold mb-2">Muscle Group Balance (28d)</h2>
  <div id="muscleBalanceChart" class="chart" style="height:240px" data-fixed-height="true"></div>
      </div>

  <!-- Recovery removed -->
    </section>

    <!-- Training Calendar Section -->
    <section class="grid gap-6 grid-cols-1">
      <div class="card col-span-12 bg-zinc-900 rounded-2xl ring-1 ring-zinc-800 shadow-sm p-5 flex flex-col">
        <h2 class="text-xl font-semibold mb-2">Training Calendar</h2>
        <p class="text-sm text-zinc-400 mb-4">Click on any workout day to view detailed information</p>
        <div id="calendarChart" class="chart" style="height:300px" data-fixed-height="true"></div>
        <div class="mt-4">
          <h3 class="text-sm text-zinc-300 mb-2">Recent Workouts</h3>
          <div id="recentWorkouts" class="grid gap-2 grid-cols-1 md:grid-cols-2"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Workout Detail Modal -->
  <div id="workoutModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
    <div class="bg-zinc-900 rounded-2xl ring-1 ring-zinc-800 shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col">
      <!-- Modal Header -->
      <div class="flex items-center justify-between p-6 border-b border-zinc-800">
        <div class="flex items-center gap-4">
          <h2 id="workoutModalTitle" class="text-2xl font-bold">Workout Details</h2>
          <div id="workoutModalBadges" class="flex gap-2"></div>
        </div>
        <div class="flex items-center gap-2">
          <button id="shareWorkoutBtn" class="px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-medium transition-colors" title="Copy shareable link">
            Share
          </button>
          <button id="closeWorkoutModal" class="p-2 hover:bg-zinc-800 rounded-lg transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Modal Content -->
      <div class="flex-1 overflow-auto p-6">
        <div id="workoutModalContent">
          <div class="flex items-center justify-center h-32 text-zinc-500">
            <div class="animate-pulse">Loading workout details...</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="/static/main.js"></script>
  <script>
    // Handle shareable workout URLs
    document.addEventListener('DOMContentLoaded', () => {
      const workoutDate = {{ workout_date|tojson if workout_date else 'null' }};
      if (workoutDate) {
        // Auto-open workout detail for shareable links
        setTimeout(() => {
          showWorkoutDetail(workoutDate);
        }, 1000); // Wait for dashboard to load
      }
    });
  </script>
</body>
</html>
